# Story Downloader GUI – مواصفات تفصيلية

## 1. نظرة عامة

تطبيق مكتبي (Desktop) بلغة بايثون يستخدم PyQt6 لواجهة عصرية، يحمّل جميع فصول قصة من موقع يملك هيكل URL موحد (`https://mywebsite.com/{slug}/{chapter}`)، ثم يحفظ كل فصل في ملف DOCX داخل مجلد باسم القصة، مع عرض تقدم التحميل وإشعارات عند الانتهاء.

## 2. المتطلبات الوظيفية

1. **إدخال المستخدم**
   - حقل نصي لـ **Base URL** (مثال: `https://mywebsite.com`)
   - حقل نصي لـ **Story Slug** (مثال: `story1`)
   - زر "Start Download" لبدء العملية

2. **الاكتشاف التلقائي لأطراف القصة**
   - يبدأ من الفصل 1 ويستمر صعودًا حتى يتلقى استجابة HTTP 404.
   - **تحسين الأداء**: يمكن تطبيق خوارزمية بحث ثنائي (binary search) لتحديد آخر رقم فصل بسرعة، إذا كان عدد الفصول كبيرًا.

3. **تحميل وتنسيق الفصول**
   - لكل فصل:
     - جلب الصفحة باستخدام `requests.Session()` مع دورة دورية على **User-Agent** وقائمة بروكسي (اختياري) لتخطي الحظر
     - استخراج العنوان من `<h1>` أو `<title>`
     - استخراج المحتوى من جميع العناصر `<p>` أو محدد CSS يُمكن تخصيصه
     - بناء مستند Word باستخدام `python-docx` مع:
       - عنوان الفصل (Heading 1)
       - فقرات النص (Paragraph)
   - حفظ كل فصل في مسار:
     ```
     ./{story_slug}/chapter_{NNN}.docx
     ```

4. **شريط التقدم واللوج**
   - **ProgressBar** يعرض نسبة التحميل بناءً على رقم الفصل الحالي مقابل آخر فصل.
   - **Log window** (QTextEdit غير قابل للتحرير) لعرض حالة كل فصل ("جلب الفصل 3 … تم"، "فشل في الفصل 7 … إعادة محاولة").

5. **الإشعارات**
   - عند انتهاء التحميل:
     - رسالة منبثقة في الواجهة
     - إشعار نظامي (System Tray Notification) إذا أمكن

6. **الاستقرار والتعامل مع الأخطاء**
   - **Retry logic**: إعادة محاولة التحميل حتى 3 مرات عند فشل الاتصال أو حالات 5xx.
   - **Timeout**: ضبط حد زمني لكل طلب (مثلاً 10 ثوانٍ).
   - تسجيل الأخطاء الكاملة في ملف `error.log` داخل مجلد القصة.

7. **التخزين المؤقت والإنهاء المبكر**
   - تخزين الفصول المحمّلة فعلاً لتجنب إعادة تنزيلها عند إعادة التشغيل.
   - زر "Stop" يسمح بإيقاف العملية بأمان.

8. **الواجهات القابلة للتعديل**
   - ملف `.ui` جاهز للتعديل عبر Qt Designer.
   - شرح خطوة التحويل إلى بايثون:
     ```bash
     pyuic6 story_downloader.ui -o story_downloader_ui.py
     ```

## 3. المتطلبات غير الوظيفية

- **عزل الهوية**:
  - استخدام قائمة Proxies دورية أو خدمة VPN API لتغيير IP، مع تدوير الـ User-Agent.
  - عدم إرسال أي بيانات تعريف (Cookies، Local Storage) من جلسة المتصفح.
- **إخراج احترافي**:
  - تعتمد على `python-docx` مع قالب DOCX مُعدّ مُسبقًا (يمكن تحميله كـ template وإضافة استايل مخصص للعناوين والفقرات).
- **توزيع**:
  - تحزيم السكربت كـ executable عبر PyInstaller مع تضمين ملفات الـ `.ui` وicon للنافذة.

## 4. هيكل المشروع

```
story_downloader/
├─ story_downloader.ui
├─ story_downloader.py
├─ story_downloader_ui.py    # بعد التحويل
├─ requirements.txt
├─ templates/
│  └─ docx_template.docx
└─ proxies.txt               # قائمة البروكسيات الاختيارية
```

## 5. خطوات التطوير

1. تصميم الواجهة في Qt Designer (`.ui`).
2. توليد الكود (`pyuic6`).
3. كتابة منطق التحميل في `DownloadThread` مع PyQt6 signals.
4. دمج `python-docx` وBeautifulSoup لاستخراج المحتوى والبناء.
5. إضافة آلية التحقق من آخر فصل (404 أو خوارزمية بحث ثنائي).
6. اختبار ضد موقع حقيقي والتأكد من تجاوز آليات التعقب.
7. تحزيم ونشر (اختياري).

